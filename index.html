<!DOCTYPE html>
<html lang="de">
<!--
  Interaktiver MolekÃ¼l-Viewer â€“ Wasser (Hâ‚‚O)
  Bibliothek : 3Dmol.js (CDN)
  OberflÃ¤che : VDW-FlÃ¤che, eingefÃ¤rbt nach elektrostatischem Potential (ESP)
  Modell     : Kugel-StÃ¤bchen, StÃ¤bchen, Kugeln, Drahtmodell (per Button umschaltbar)
  ESP        : GauÃŸ-geglÃ¤ttetes Potential aus TIP3P-Partialladungen,
               Roter Bereich = elektronenreich (O), Blauer Bereich = elektroarm (H)
-->
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interaktiver MolekÃ¼l-Viewer</title>
  <script src="https://3dmol.org/build/3Dmol-min.js"></script>
  <style>
    /* â”€â”€â”€ CSS-Variablen fÃ¼r das dunkle Dark-Mode-Design â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    :root {
      --bg:       #0d1117;
      --surface:  #161b22;
      --border:   #30363d;
      --accent:   #58a6ff;
      --red:      #ff6b6b;
      --green:    #56d364;
      --amber:    #e3b341;
      --text:     #e6edf3;
      --muted:    #8b949e;
      --btn-h:    #21262d;
      --radius:   8px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* â”€â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.7rem 1.4rem;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }
    header h1 {
      font-size: 1.15rem;
      font-weight: 700;
      color: var(--accent);
      letter-spacing: 0.02em;
    }
    .badge {
      background: rgba(88,166,255,0.10);
      color: var(--accent);
      border: 1px solid rgba(88,166,255,0.25);
      border-radius: 20px;
      padding: 0.12rem 0.55rem;
      font-size: 0.7rem;
      font-weight: 500;
    }
    .badge.red { background:rgba(255,107,107,0.12); color:var(--red);   border-color:rgba(255,107,107,0.3); }
    .badge.grn { background:rgba(86,211,100,0.12);  color:var(--green); border-color:rgba(86,211,100,0.3);  }

    /* â”€â”€â”€ Hauptlayout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .main { flex: 1; display: flex; min-height: 0; }

    /* â”€â”€â”€ 3D-Viewer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #viewer-wrap { flex: 1; position: relative; min-width: 0; }
    #viewer      { position: absolute; inset: 0; }

    /* â”€â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    aside {
      width: 222px;
      flex-shrink: 0;
      background: var(--surface);
      border-left: 1px solid var(--border);
      padding: 0.85rem;
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
      overflow-y: auto;
    }
    .card {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 0.75rem;
    }
    .card-title {
      font-size: 0.62rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--muted);
      margin-bottom: 0.55rem;
    }

    /* â”€â”€â”€ Stil-Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 0.4rem; }
    .btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.3rem;
      padding: 0.42rem 0.4rem;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--btn-h);
      color: var(--muted);
      font-size: 0.71rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.15s, color 0.15s, border-color 0.15s;
      white-space: nowrap;
    }
    .btn:hover  { background: #2d333b; color: var(--text); }
    .btn.aktiv  {
      background: rgba(88,166,255,0.18);
      color: var(--accent);
      border-color: rgba(88,166,255,0.5);
    }

    /* â”€â”€â”€ Toggle-Schalter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .toggle-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.45rem;
      cursor: pointer;
    }
    .toggle-label { font-size: 0.77rem; }
    .toggle { position: relative; width: 34px; height: 18px; }
    .toggle input { opacity: 0; width: 0; height: 0; }
    .slider-t {
      position: absolute;
      inset: 0;
      border-radius: 18px;
      background: #30363d;
      transition: background 0.2s;
    }
    .slider-t::before {
      content: '';
      position: absolute;
      width: 12px; height: 12px;
      border-radius: 50%;
      background: #fff;
      left: 3px; top: 3px;
      transition: transform 0.2s;
    }
    .toggle input:checked + .slider-t.rot { background: var(--red);   }
    .toggle input:checked + .slider-t.grn { background: var(--green); }
    .toggle input:checked + .slider-t::before { transform: translateX(16px); }

    /* â”€â”€â”€ OpazitÃ¤ts-Slider â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .slider-wrap { margin-top: 0.45rem; }
    .slider-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.71rem;
      color: var(--muted);
      margin-bottom: 0.22rem;
    }
    .slider-row span:last-child { color: var(--text); font-weight: 600; }
    input[type=range] { width: 100%; accent-color: var(--accent); cursor: pointer; }

    /* â”€â”€â”€ Eigenschafts-Zeilen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .prop {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.28rem;
      font-size: 0.75rem;
    }
    .prop .lbl { color: var(--muted); }
    .prop .val { color: var(--text); font-weight: 500; }

    /* â”€â”€â”€ ESP-Farbskala â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .esp-skala {
      width: 100%;
      height: 12px;
      border-radius: 4px;
      background: linear-gradient(to right, #e84040, #ffffff, #3a8fea);
      margin: 0.5rem 0 0.25rem;
      border: 1px solid var(--border);
    }
    .esp-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.62rem;
      color: var(--muted);
    }

    /* â”€â”€â”€ Legende â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .legend-row {
      display: flex; align-items: center; gap: 0.45rem;
      font-size: 0.75rem; margin-bottom: 0.32rem; line-height: 1.3;
    }
    .dot { width: 11px; height: 11px; border-radius: 50%; flex-shrink: 0; }

    /* â”€â”€â”€ Hinweistext â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .hint { font-size: 0.7rem; color: var(--muted); line-height: 1.65; }

    /* â”€â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    footer {
      font-size: 0.65rem;
      color: var(--muted);
      text-align: center;
      padding: 0.3rem;
      background: var(--surface);
      border-top: 1px solid var(--border);
      flex-shrink: 0;
    }
  </style>
</head>
<body>

  <!-- â•â•â• HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <header>
    <h1>Interaktiver MolekÃ¼l-Viewer</h1>
    <span class="badge">Wasser Hâ‚‚O</span>
    <span class="badge red">Elektrostatisches Potential</span>
    <span class="badge grn">Kugel-StÃ¤bchen</span>
  </header>

  <!-- â•â•â• HAUPTBEREICH â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="main">

    <!-- 3D-Viewer â€“ nimmt den gesamten verbleibenden Platz ein -->
    <div id="viewer-wrap">
      <div id="viewer"></div>
    </div>

    <!-- â•â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <aside>

      <!-- MolekÃ¼linformationen -->
      <div class="card">
        <div class="card-title">MolekÃ¼l</div>
        <div class="prop"><span class="lbl">Formel</span>        <span class="val">Hâ‚‚O</span></div>
        <div class="prop"><span class="lbl">Atome</span>         <span class="val">3</span></div>
        <div class="prop"><span class="lbl">Bindungen</span>     <span class="val">2</span></div>
        <div class="prop"><span class="lbl">Geometrie</span>     <span class="val">gewinkelt</span></div>
        <div class="prop"><span class="lbl">Hâ€“Oâ€“H Winkel</span> <span class="val">104.5Â°</span></div>
        <div class="prop"><span class="lbl">Oâ€“H LÃ¤nge</span>     <span class="val">0.96 Ã…</span></div>
      </div>

      <!-- Darstellungsstil â€“ Buttons sind mit JS-Listenern verknÃ¼pft -->
      <div class="card">
        <div class="card-title">Darstellungsstil</div>
        <div class="btn-group">
          <button class="btn aktiv" data-stil="ballstick">âš« Kugel-StÃ¤bchen</button>
          <button class="btn"       data-stil="stick">â€” Nur StÃ¤bchen</button>
          <button class="btn"       data-stil="sphere">â— Nur Kugeln</button>
          <button class="btn"       data-stil="line">â‹¯ Drahtmodell</button>
        </div>
      </div>

      <!-- ESP-OberflÃ¤che â€“ Toggle und OpazitÃ¤ts-Slider sind beide funktional -->
      <div class="card">
        <div class="card-title">ESP-OberflÃ¤che (VDW)</div>
        <label class="toggle-row">
          <span class="toggle-label">OberflÃ¤che anzeigen</span>
          <label class="toggle">
            <input type="checkbox" id="esp-toggle" checked />
            <span class="slider-t rot"></span>
          </label>
        </label>
        <div class="slider-wrap">
          <div class="slider-row">
            <span>OpazitÃ¤t</span>
            <span id="opazitaet-wert">0.70</span>
          </div>
          <input type="range" id="opazitaet-slider"
                 min="0.05" max="1.00" step="0.05" value="0.70" />
        </div>
        <div class="esp-skala"></div>
        <div class="esp-labels">
          <span>âˆ’ negativ (O)</span>
          <span>0</span>
          <span>+ positiv (H)</span>
        </div>
      </div>

      <!-- Elektronendichte-IsoflÃ¤chen â€“ Toggle ist funktional -->
      <div class="card">
        <div class="card-title">Elektronendichte-IsoflÃ¤chen</div>
        <label class="toggle-row">
          <span class="toggle-label">IsoflÃ¤chen anzeigen</span>
          <label class="toggle">
            <input type="checkbox" id="dichte-toggle" />
            <span class="slider-t grn"></span>
          </label>
        </label>
        <div class="prop" style="margin-top:0.4rem">
          <span class="lbl">Ã„uÃŸere FlÃ¤che Î·</span><span class="val">0.10</span>
        </div>
        <div class="prop">
          <span class="lbl">Innere FlÃ¤che Î·</span><span class="val">0.55</span>
        </div>
        <div class="prop">
          <span class="lbl">Methode</span><span class="val">GauÃŸ-Î£</span>
        </div>
      </div>

      <!-- Atom-Legende -->
      <div class="card">
        <div class="card-title">Legende</div>
        <div class="legend-row">
          <span class="dot" style="background:#e04040"></span>Sauerstoff (O)
        </div>
        <div class="legend-row">
          <span class="dot" style="background:#c8c8c8;border:1px solid #555"></span>Wasserstoff (H)
        </div>
        <div class="legend-row">
          <span class="dot" style="background:rgba(233,64,64,0.55);border:1px solid #e04040"></span>ESP-FlÃ¤che: negativ
        </div>
        <div class="legend-row">
          <span class="dot" style="background:rgba(58,143,234,0.55);border:1px solid #3a8fea"></span>ESP-FlÃ¤che: positiv
        </div>
      </div>

      <!-- Steuerungshinweise -->
      <div class="card">
        <div class="card-title">Steuerung</div>
        <p class="hint">
          ğŸ–± <b>Drehen</b><br>Linksklick &amp; ziehen<br><br>
          ğŸ” <b>Zoom</b><br>Scrollrad<br><br>
          âœ‹ <b>Verschieben</b><br>Rechtsklick &amp; ziehen
        </p>
      </div>

    </aside>
  </div>

  <footer>
    3Dmol.js Â· GauÃŸ-Cube ESP aus TIP3P-Partialladungen (synthetisch) Â· kein externer Datenzugriff erforderlich
  </footer>

  <!-- â•â•â• JAVASCRIPT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script>
  'use strict';

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  1. MOLEKÃœL-DATEN: Wasser (Hâ‚‚O) im SDF-Format
  //     Koordinaten in Ã…ngstrÃ¶m (Ã…), experimentelle Geometrie:
  //       O ist leicht nach oben verschoben (Massenschwerpunkt-Zentrierung),
  //       H-Atome symmetrisch links/rechts.
  //       Hâ€“Oâ€“H Winkel â‰ˆ 104.45Â°, Oâ€“H LÃ¤nge â‰ˆ 0.9572 Ã…
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const WASSER_SDF = `
     H2O         3D

  3  2  0  0  0  0  0  0  0  0999 V2000
    0.0000    0.1173    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0
    0.7572   -0.4692    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0
   -0.7572   -0.4692    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0
  1  2  1  0
  1  3  1  0
M  END
$$$$`;

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  2. VOLUMENDATEN: Hilfsfunktionen fÃ¼r das Gaussian-Cube-Format
  //
  //  Das Gaussian-Cube-Format ist ein weit verbreitetes Format fÃ¼r 3D-
  //  Volumendaten in der Quantenchemie.
  //  Einheit der Koordinaten: Bohr-Radien (1 Ã… = 1.88973 Bohr)
  //
  //  Aufbau:
  //    Zeilen 1-2  : Freitext-Kommentare
  //    Zeile  3    : Anzahl Atome + Ursprung des Gitters (xâ‚€, yâ‚€, zâ‚€)
  //    Zeilen 4-6  : Gittervektoren (je Anzahl Punkte + Schrittweite)
  //    Zeilen 7+   : Atome (Kernladung, Partialladung, x, y, z)
  //    Rest        : Volumendaten (6 Werte pro Zeile)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  // Umrechnungsfaktor Ã…ngstrÃ¶m â†’ Bohr
  const A2B = 1.88972599;

  // Wasser-Atome mit Positionen in Bohr und TIP3P-Partialladungen.
  // TIP3P ist ein klassisches Wassermodell, das hÃ¤ufig in Simulationen genutzt wird.
  // Die Partialladungen q spiegeln die ElektronegativitÃ¤t wider:
  //   Sauerstoff (q = âˆ’0.834): zieht Elektronen stark an â†’ elektronenreich
  //   Wasserstoff (q = +0.417): gibt Elektronen ab â†’ elektroarm
  const ATOME_BOHR = [
    { Z: 8, q: -0.834, x:  0.0000 * A2B, y:  0.1173 * A2B, z: 0.0 }, // Sauerstoff
    { Z: 1, q:  0.417, x:  0.7572 * A2B, y: -0.4692 * A2B, z: 0.0 }, // Wasserstoff 1
    { Z: 1, q:  0.417, x: -0.7572 * A2B, y: -0.4692 * A2B, z: 0.0 }, // Wasserstoff 2
  ];

  // Gitter: Â±4.5 Ã… in x/y, Â±3.0 Ã… in z â€“ ausreichend groÃŸ fÃ¼r das ESP-Fernfeld
  const NX = 22, NY = 22, NZ = 16;
  const XMIN = -4.5 * A2B, XMAX = 4.5 * A2B;
  const YMIN = -4.5 * A2B, YMAX = 4.5 * A2B;
  const ZMIN = -3.0 * A2B, ZMAX = 3.0 * A2B;
  const DX = (XMAX - XMIN) / (NX - 1);
  const DY = (YMAX - YMIN) / (NY - 1);
  const DZ = (ZMAX - ZMIN) / (NZ - 1);

  // Zahl mit 6 Dezimalstellen formatieren (fÃ¼r Cube-Textformat nÃ¶tig)
  function fmt(n) { return n.toFixed(6); }

  // Gemeinsamer Header + Atom-Block fÃ¼r beide Cube-Dateien
  function cubeHeader(kommentar) {
    const N = ATOME_BOHR.length;
    const z = [
      kommentar,
      'Generiert durch JavaScript â€“ kein externer Datei-Zugriff',
      `${N} ${fmt(XMIN)} ${fmt(YMIN)} ${fmt(ZMIN)}`,
      `${NX} ${fmt(DX)} 0.000000 0.000000`,
      `${NY} 0.000000 ${fmt(DY)} 0.000000`,
      `${NZ} 0.000000 0.000000 ${fmt(DZ)}`,
    ];
    // Jede Atom-Zeile: Kernladungszahl, Partialladung, x, y, z
    for (const a of ATOME_BOHR) {
      z.push(`${a.Z} 0.000000 ${fmt(a.x)} ${fmt(a.y)} ${fmt(a.z)}`);
    }
    return z;
  }

  // Float64Array von Volumenwerten â†’ Gaussian-Cube-Textzeilen (6 Werte/Zeile)
  function volumenZuText(werte) {
    const zeilen = [];
    for (let i = 0; i < werte.length; i += 6) {
      const zeile = [];
      for (let j = i; j < Math.min(i + 6, werte.length); j++) {
        zeile.push(werte[j].toExponential(5).padStart(13));
      }
      zeilen.push(zeile.join(''));
    }
    return zeilen;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  3. ELEKTROSTATISCHES POTENTIAL (ESP-Cube)
  //
  //  Statt des echten Coulomb-Potentials (1/r, singulÃ¤r an Atomkernen)
  //  verwenden wir eine GauÃŸ-geglÃ¤ttete NÃ¤herung:
  //
  //    ESP(r) = Î£áµ¢  qáµ¢ Â· exp(âˆ’Î± Â· |r âˆ’ ráµ¢|Â²)
  //
  //  Î± = 0.70 (Bohrâ»Â²) liefert ein visuell gut lesbares Ergebnis:
  //    â€¢ Nahe O (qâ‚’ = âˆ’0.834): stark negativ â†’ roter Bereich der OberflÃ¤che
  //    â€¢ Nahe H (qâ‚• = +0.417): leicht positiv â†’ blauer Bereich
  //    â€¢ Fernfeld: â†’ 0                        â†’ weiÃŸer Ãœbergangsbereich
  //
  //  Diese Verteilung erklÃ¤rt, warum Wasser ein polar-gewinkeltes MolekÃ¼l
  //  mit einem negativen Dipol-Ende (O) und zwei positiven Enden (H) ist.
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function buildESPKubus() {
    const werte = new Float64Array(NX * NY * NZ);
    let idx = 0;
    for (let ix = 0; ix < NX; ix++) {
      const cx = XMIN + ix * DX;
      for (let iy = 0; iy < NY; iy++) {
        const cy = YMIN + iy * DY;
        for (let iz = 0; iz < NZ; iz++) {
          const cz = ZMIN + iz * DZ;
          let esp = 0;
          for (const a of ATOME_BOHR) {
            const r2 = (cx - a.x) ** 2 + (cy - a.y) ** 2 + (cz - a.z) ** 2;
            esp += a.q * Math.exp(-0.7 * r2); // GauÃŸ-GlÃ¤ttung mit Î± = 0.70
          }
          werte[idx++] = esp;
        }
      }
    }
    return [...cubeHeader('Wasser ESP â€“ elektrostatisches Potential (GauÃŸ-NÃ¤herung)'),
            ...volumenZuText(werte)].join('\n');
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  4. ELEKTRONENDICHTE (Dichte-Cube)
  //
  //  Vereinfachte Elektronendichte als Summe gewichteter GauÃŸ-Funktionen:
  //
  //    Ï(r) = Î£áµ¢  Záµ¢ Â· exp(âˆ’Î±áµ¢ Â· |r âˆ’ ráµ¢|Â²)
  //
  //  Záµ¢ = Kernladungszahl (O: Z=8 dominiert das Bild, H: Z=1 kleiner Beitrag)
  //  Die Isowert-Schnitte zeigen:
  //    Ï = 0.10 â†’ Ã¤uÃŸere, diffuse ElektronenhÃ¼lle (blau, fast transparent)
  //    Ï = 0.55 â†’ innerer, dichter Kernbereich (amber, halbtransparent)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function buildDichteKubus() {
    const werte = new Float64Array(NX * NY * NZ);
    let idx = 0;
    for (let ix = 0; ix < NX; ix++) {
      const cx = XMIN + ix * DX;
      for (let iy = 0; iy < NY; iy++) {
        const cy = YMIN + iy * DY;
        for (let iz = 0; iz < NZ; iz++) {
          const cz = ZMIN + iz * DZ;
          let rho = 0;
          for (const a of ATOME_BOHR) {
            const r2 = (cx - a.x) ** 2 + (cy - a.y) ** 2 + (cz - a.z) ** 2;
            // Î±_O = 0.80 (kompakter Kern), Î±_H = 0.45 (diffuse HÃ¼lle)
            const alpha = a.Z === 8 ? 0.80 : 0.45;
            rho += a.Z * Math.exp(-alpha * r2);
          }
          werte[idx++] = rho;
        }
      }
    }
    return [...cubeHeader('Wasser Elektronendichte (GauÃŸ-NÃ¤herung)'),
            ...volumenZuText(werte)].join('\n');
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  5. VIEWER INITIALISIEREN
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // $3Dmol.createViewer() erzeugt eine WebGL-Canvas im angegebenen Container.
  const viewer = $3Dmol.createViewer('viewer', {
    backgroundColor: '#080d14', // fast schwarzer Hintergrund
  });

  // Das Wasser-MolekÃ¼l aus dem SDF-String laden.
  // 3Dmol.js erkennt Bindungen und Elementtypen automatisch aus dem Format.
  const mol = viewer.addModel(WASSER_SDF, 'sdf');

  // Volumendaten einlesen â€“ $3Dmol.VolumeData parst das Gaussian-Cube-Format
  const espVolDaten    = new $3Dmol.VolumeData(buildESPKubus(),    'cube');
  const dichteVolDaten = new $3Dmol.VolumeData(buildDichteKubus(), 'cube');

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  6. ZUSTANDSVARIABLEN DER UI
  //     Diese Variablen spiegeln immer den aktuellen Anzeigemodus wider.
  //     Jede Ã„nderung durch einen Event-Listener aktualisiert sie.
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  let stilModus      = 'ballstick'; // aktiver Darstellungsstil (Button-Auswahl)
  let espSichtbar    = true;        // ESP-OberflÃ¤che sichtbar?
  let dichteSichtbar = false;       // Elektronendichte-IsoflÃ¤chen sichtbar?
  let opazitaet      = 0.70;        // OpazitÃ¤t der ESP-OberflÃ¤che (0.05 â€“ 1.00)

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  7. DARSTELLUNGSSTIL ANWENDEN
  //     viewer.setStyle(selektor, stilObjekt) setzt den Render-Stil.
  //     Mit leerem Selektor {} werden alle Atome des Modells erfasst.
  //     'Jmol' ist das Standardfarbschema: O=rot, H=weiÃŸ, ...
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function stilAnwenden() {
    switch (stilModus) {
      case 'ballstick':
        // Kugel-StÃ¤bchen: Kugeln zeigen Elementtyp, StÃ¤bchen die Bindungen
        viewer.setStyle({}, {
          stick:  { radius: 0.15, colorscheme: 'Jmol' },
          sphere: { scale:  0.35, colorscheme: 'Jmol' },
        });
        break;
      case 'stick':
        // Nur StÃ¤bchen: betont Bindungswinkel und -lÃ¤ngen
        viewer.setStyle({}, {
          stick: { radius: 0.18, colorscheme: 'Jmol' },
        });
        break;
      case 'sphere':
        // Van-der-Waals-Kugeln: zeigt die realen AtomgrÃ¶ÃŸenverhÃ¤ltnisse
        viewer.setStyle({}, {
          sphere: { scale: 0.5, colorscheme: 'Jmol' },
        });
        break;
      case 'line':
        // Drahtmodell: sehr minimal, gut fÃ¼r komplexere MolekÃ¼le
        viewer.setStyle({}, {
          line: { linewidth: 3, colorscheme: 'Jmol' },
        });
        break;
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  8. OBERFLÃ„CHEN AKTUALISIEREN
  //     3Dmol.js hat keine â€show/hide"-Funktion fÃ¼r OberflÃ¤chen.
  //     Deshalb: alle FlÃ¤chen entfernen, dann aktive neu aufbauen.
  //     Das dauert ca. 50-150 ms und ist fÃ¼r den Nutzer kaum spÃ¼rbar.
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function oberflaechenAktualisieren() {
    // Alle vorhandenen FlÃ¤chen aus dem Viewer entfernen
    viewer.removeAllSurfaces();

    // â”€â”€ ESP-VDW-OberflÃ¤che â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // addSurface(typ, stilOptionen) erzeugt eine MolekÃ¼loberflÃ¤che.
    // SurfaceType.VDW = Van-der-Waals-OberflÃ¤che (gebrÃ¤uchlichste Form).
    //
    // voldata : VolumeData-Objekt, das pro Gitterpunkt einen Wert speichert.
    //           3Dmol.js interpoliert den ESP-Wert auf jeden OberflÃ¤chen-Punkt.
    // volscheme: Farbverlauf, der Werte auf Farben abbildet.
    //   RWB(min, max): Redâ€“Whiteâ€“Blue
    //     min-Wert â†’ Rot  (negatives ESP = Sauerstoff-Seite)
    //     ~0-Wert  â†’ WeiÃŸ (neutrales Ãœbergangsgebiet)
    //     max-Wert â†’ Blau (positives ESP = Wasserstoff-Seite)
    if (espSichtbar) {
      viewer.addSurface(
        $3Dmol.SurfaceType.VDW,
        {
          opacity:   opazitaet,
          voldata:   espVolDaten,
          volscheme: new $3Dmol.Gradient.RWB(-0.40, 0.20),
        }
      );
    }

    // â”€â”€ Elektronendichte-IsoflÃ¤chen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // addIsosurface(volData, optionen) schneidet das Volumen bei einem
    // festen Schwellwert (isoval) und erzeugt die GrenzflÃ¤che.
    if (dichteSichtbar) {
      // Ã„uÃŸere HÃ¼lle: diffuses, groÃŸes Gebiet (blau, fast transparent)
      viewer.addIsosurface(dichteVolDaten, {
        isoval:     0.10,
        color:      '#58a6ff',
        opacity:    0.18,
        smoothness: 8,
        wireframe:  false,
      });
      // Innerer Kern: dichtester Bereich nahe den Atomkernen (amber, halbdeckend)
      viewer.addIsosurface(dichteVolDaten, {
        isoval:     0.55,
        color:      '#e3b341',
        opacity:    0.45,
        smoothness: 6,
        wireframe:  false,
      });
    }

    viewer.render();
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  9. ERSTMALIGE DARSTELLUNG beim Laden der Seite
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  stilAnwenden();
  oberflaechenAktualisieren();
  viewer.zoomTo();   // Kameraausschnitt automatisch auf das MolekÃ¼l anpassen
  viewer.zoom(1.1);  // Leicht reinzoomen fÃ¼r bessere Sichtbarkeit des kleinen MolekÃ¼ls
  viewer.render();

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  10. EVENT LISTENER â€“ Verbindung zwischen HTML-Steuerelementen und Viewer
  //
  //  Hier wird jeder Button und jeder Toggle mit einer JavaScript-Funktion
  //  verknÃ¼pft. Ohne diese Listener hÃ¤tten die UI-Elemente keine Wirkung.
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  // â”€â”€ Darstellungsstil-Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // querySelectorAll('[data-stil]') findet alle Buttons mit einem data-stil-Attribut.
  // Beim Klick: alten Aktiv-Zustand entfernen, neuen setzen, Stil anwenden.
  document.querySelectorAll('[data-stil]').forEach(btn => {
    btn.addEventListener('click', () => {
      // Alle Stil-Buttons: aktive Hervorhebung entfernen
      document.querySelectorAll('[data-stil]').forEach(b => b.classList.remove('aktiv'));
      // Nur der angeklickte Button wird als aktiv markiert
      btn.classList.add('aktiv');
      // Stil-Modus aus HTML-data-Attribut auslesen und in den Viewer Ã¼bertragen
      stilModus = btn.dataset.stil;
      stilAnwenden();
      viewer.render();
    });
  });

  // â”€â”€ ESP-OberflÃ¤che: Toggle-Schalter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // 'change'-Event feuert, wenn die Checkbox ihren Zustand Ã¤ndert.
  // e.target.checked liefert true (eingeschaltet) oder false (ausgeschaltet).
  document.getElementById('esp-toggle').addEventListener('change', e => {
    espSichtbar = e.target.checked;
    oberflaechenAktualisieren(); // Alle OberflÃ¤chen neu aufbauen
  });

  // â”€â”€ Elektronendichte: Toggle-Schalter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('dichte-toggle').addEventListener('change', e => {
    dichteSichtbar = e.target.checked;
    oberflaechenAktualisieren();
  });

  // â”€â”€ OpazitÃ¤ts-Schieberegler â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // 'input' feuert sofort bei jeder Slider-Bewegung (nicht erst beim Loslassen).
  // Der angezeigte Zahlenwert und die OberflÃ¤chen-OpazitÃ¤t werden live aktualisiert.
  document.getElementById('opazitaet-slider').addEventListener('input', e => {
    opazitaet = parseFloat(e.target.value);
    // Zahlenwert in der Sidebar live aktualisieren
    document.getElementById('opazitaet-wert').textContent = opazitaet.toFixed(2);
    // Nur neu rendern wenn die OberflÃ¤che gerade sichtbar ist
    if (espSichtbar) {
      oberflaechenAktualisieren();
    }
  });

  </script>
</body>
</html>